<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pivot-Like Table Example with Tabulator</title>

    <!-- Include Tabulator CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables@latest/dist/css/tabulator.min.css">

    <!-- Include Tabulator JS -->
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@latest/dist/js/tabulator.min.js"></script>
</head>
<body>

<!-- Table container -->
<div id="pivot-container"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample data
    var tableData = [];

    fetch('/olympiads/json/133/')
        .then(response => response.json())
        .then(data => {
            tableData=data
            var transformedData = {};
            tableData.forEach(function(row) {
                if (!transformedData[row.contestant_id]) {
                    transformedData[row.contestant_id] = {};
                    transformedData[row.contestant_id]["name"] = row.contestant__first_name;
                }
                transformedData[row.contestant_id][row.problem_id] = row.score;
            });
            var pivotTableData = [];
            for (var contestantId in transformedData) {
                var rowData = { "contestant_id": contestantId, "contestant_name": transformedData[contestantId]["name"]};
                for (var problemId in transformedData[contestantId]) {
                    rowData[problemId] = transformedData[contestantId][problemId];
                }
                pivotTableData.push(rowData);
            }
            var table = new Tabulator("#pivot-container", {
                data: pivotTableData,
                layout: "fitColumns",
                columns: [
                    { title: "ID", field: "contestant_id"},
                    { title: "Нэр", field: "name"},
                    { title: "№1", field: "813"},
                    { title: "№2", field: "814"},
                    { title: "№3", field: "815"},
                    { title: "№4", field: "816"},
                    { title: "№5", field: "817"},
                    { title: "№6", field: "818"},
                    { title: "№7", field: "819"},
                    { title: "№8", field: "820"},
                    { title: "№9", field: "821"},
                    { title: "№10", field: "822"}
                ],
                rowClick: function (e, row) {
                    console.log(e)
                }
            });
        })
    console.log(tableData)
});
</script>

</body>
</html>

